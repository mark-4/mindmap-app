# マインドマップアプリ

PySide6を使用したデスクトップマインドマップアプリケーションです。直感的な操作で美しいマインドマップを作成できます。

## 機能

### 基本機能
- **ノード操作**: 追加・削除・移動・リネーム
- **接続線**: 自動描画と交差回避
- **Undo/Redo**: 操作の取り消し・やり直し
- **保存・読み込み**: JSON形式でのデータ永続化

### 高度な機能
- **整理ボタン**: 世代別整列と接続線交差解消
- **グリッド表示**: 背景グリッドの表示/非表示（5px/100px）
- **グリッドスナップ**: ノード移動時のグリッド吸着
- **透明度調整**: 背景・ノード・接続線の個別透明度設定
- **ズーム速度調整**: マウスホイールズームの速度調整
- **キーボードナビゲーション**: 矢印キーでのノード選択移動
- **アピアランス切り替え**: 3つのテーマ（デフォルト・グレー・パステル）

### 安全機能
- **衝突検出**: ノード同士の重なり防止（5px間隔）
- **接続線交差回避**: 接続線同士の交差を自動解決
- **サブツリー移動**: 親ノードと子ノードの一括移動
- **クラッシュ防止**: 安全チェックとエラー処理
- **パフォーマンス最適化**: 大量ノードでの安定動作

## インストール

### 必要な環境
- Python 3.11以上
- PySide6

### セットアップ
```bash
# 仮想環境の作成
python -m venv .venv
source .venv/bin/activate  # macOS/Linux
# .venv\Scripts\activate  # Windows

# 依存関係のインストール
pip install PySide6

# アプリケーションの実行
python main.py
```

## 使用方法

### 基本操作
1. **ノード追加**: Tabキーまたはツールバーの「ノード追加」ボタン
2. **ノード移動**: ドラッグ&ドロップ
3. **ノード削除**: Delete/Backspaceキーまたはツールバーの「削除」ボタン
4. **ノードリネーム**: ノードをダブルクリック
5. **接続作成**: Shiftキーを押しながら2つのノードをクリック
6. **サブツリー移動**: 親ノードをドラッグ（子ノードも一緒に移動）
7. **単一ノード移動**: Shiftキーを押しながらドラッグ

### キーボードショートカット
- `Tab`: ノード追加
- `Delete/Backspace`: 選択ノード削除
- `Cmd+Z`: Undo
- `Cmd+Shift+Z`: Redo
- `Cmd+S`: 保存
- `Cmd+O`: 読み込み
- `↑↓←→`: ノード選択移動
- `Escape`: 接続モードキャンセル

### ツールバー機能
- **接続モード**: ノード間の接続を有効/無効
- **整理**: 世代別整列と接続線交差解消
- **フィット**: 全ノードを画面に収める
- **ズーム速度**: ズーム速度の調整（スライダー）
- **透明度**: 背景・ノード・接続線の透明度調整
- **グリッド**: 背景グリッドの表示/非表示
- **グリッドスナップ**: ノード移動時のグリッド吸着
- **アピアランス**: UIテーマの切り替え（デフォルト・グレー・パステル）

### 整理ボタンの機能
- **世代別整列**: 同じ世代のノードを左端で揃える
- **接続線水平化**: 線形チェーンの接続線を水平に
- **交差解消**: 接続線同士の交差を自動解決
- **ノード重なり防止**: ノード同士の重なりを解消
- **コンパクト配置**: 画面内に効率的にレイアウト

## 技術仕様

### アーキテクチャ
- **フレームワーク**: PySide6 (Qt6)
- **言語**: Python 3.11+
- **アーキテクチャ**: MVCパターン

### 主要クラス
- `MainWindow`: メインウィンドウとツールバー管理
- `MindMapView`: グラフィックスビューとキャンバス
- `NodeItem`: ドラッグ可能なノード
- `CrankConnection`: 3段階クランク状接続線
- `QUndoCommand`: Undo/Redo機能
- `NodeTextEditor`: インライン編集機能

### データ形式
- **保存形式**: JSON
- **ノード情報**: 位置、テキスト、接続関係
- **接続線**: 3段階クランク状（水平→垂直→水平）

### アルゴリズム
- **衝突検出**: ノード同士の重なり検出と回避
- **接続線交差検出**: 線分交差判定アルゴリズム
- **世代別整列**: 階層構造に基づくノード配置
- **コンパクト配置**: 画面内最適化アルゴリズム

## 開発情報

### コード品質
- **リンター**: Ruff + Black
- **Pre-commit**: 自動フォーマットとリント
- **型ヒント**: 完全な型アノテーション

### ファイル構成
```
maps/
├── main.py                 # メインアプリケーション
├── view.py                 # マインドマップビューとレイアウト
├── node.py                 # ノードアイテムクラス
├── connection.py           # 接続線クラス
├── commands.py             # Undo/Redoコマンド
├── text_editor.py          # テキスト編集機能
├── dialogs.py              # ダイアログ機能
├── pyproject.toml         # プロジェクト設定
└── README.md              # このファイル
```

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 貢献

プルリクエストやイシューの報告を歓迎します。

## 更新履歴

### v1.2.0 (2024-12-27)
- 整理ボタンの交差解消処理を改善
- 無限ループ問題を修正
- ノード重なり防止を強化
- コンパクト配置機能を追加
- 接続線交差回避アルゴリズムを最適化
- パフォーマンス向上

### v1.1.0 (2024-12-26)
- アピアランス切り替え機能を追加
- 3つのテーマ（デフォルト・グレー・パステル）
- 整理ボタンの機能強化
- 接続線交差検出と解消機能
- 世代別整列機能の改善

### v1.0.0 (2024-09-28)
- 初回リリース
- 基本機能の実装
- 高度な機能の追加
- 安全機能の実装
- パフォーマンス最適化
